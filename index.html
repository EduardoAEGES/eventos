<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos CONTA - PLN 2026</title>

    <!-- Fuentes Google Fonts: Inter y Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- Iconos (Phosphor Icons - CDN ligero y moderno) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- SweetAlert2 para popups responsivos -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- PapaParse para procesado robusto de CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- jQuery y Select2 para Autocompletado Búsqueda en Selects -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar de Navegación -->
        <aside class="sidebar">
            <div class="logo">
                <i class="ph-fill ph-certificate"></i>
                <span>Eventos CONTA - PLN 2026</span>
            </div>

            <nav class="nav-menu">
                <button class="nav-btn active" data-target="dashboard">
                    <i class="ph ph-squares-four"></i>
                    <span>Inicio</span>
                </button>
                <button class="nav-btn" data-target="eventos">
                    <i class="ph ph-calendar"></i>
                    <span>Eventos</span>
                </button>
                <button class="nav-btn" data-target="comunicacion">
                    <i class="ph ph-chat-circle-text"></i>
                    <span>Comunicación</span>
                </button>
                <button class="nav-btn" data-target="generacion">
                    <i class="ph ph-file-pdf"></i>
                    <span>Generación</span>
                </button>
                <!--
                <button class="nav-btn" data-target="envio">
                    <i class="ph ph-paper-plane-tilt"></i>
                    <span>Envío Masivo</span>
                </button> 
                -->
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">AD</div>
                    <div class="user-info">
                        <span class="name">Admin</span>
                        <span class="role">Administrador</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Área Principal -->
        <main class="main-content">
            <header class="top-bar">
                <h1 id="page-title">Panel de Control</h1>
                <div class="actions" style="display: flex; gap: 10px;">
                    <button class="btn-primary"
                        onclick="window.open('https://docs.google.com/spreadsheets/d/1sHLHwIZbAXlThGj8qTY0QxVn68BL_zOGMvMPE73LfJs/edit?usp=sharing', '_blank')"
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.95rem; padding: 0.6rem 1.2rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.5); color: #60a5fa; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        <i class="ph ph-file-xls" style="font-size: 1.2rem;"></i>
                        Sheets CERTUS
                    </button>
                    <button class="btn-primary"
                        onclick="window.open('https://docs.google.com/spreadsheets/d/1p34BL8wZua7Pv4G362HTZUkAVGc_s-1w7HMceZa61T8/edit?usp=sharing', '_blank')"
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.95rem; padding: 0.6rem 1.2rem; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.5); color: #10b981; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        <i class="ph ph-file-xls" style="font-size: 1.2rem;"></i>
                        Sheets COT PLN
                    </button>
                    <button class="btn-primary" onclick="window.open('portal.html', '_blank')"
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.95rem; padding: 0.6rem 1.2rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.5); color: #60a5fa; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        <i class="ph ph-student" style="font-size: 1.2rem;"></i>
                        Portal Alumnos
                    </button>
                    <button class="btn-primary"
                        onclick="window.open('https://automatizardocumentos-pln-s8i2.onrender.com/', '_blank')"
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.95rem; padding: 0.6rem 1.2rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.5); color: #60a5fa; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        <i class="ph ph-arrow-square-out" style="font-size: 1.2rem;"></i>
                        Abrir Aplicación
                    </button>
                </div>
            </header>

            <!-- Sección: Dashboard -->
            <section id="dashboard" class="content-section active">
                <div class="calendar-header"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>Cronograma General</h2>
                    <div class="calendar-filters" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <select id="calendar-visibility-filter" class="input-modern small">
                            <option value="all">Todas las visibilidades</option>
                            <option value="publico">Solo Públicos</option>
                            <option value="privado">Solo Internos/Privados</option>
                        </select>
                        <select id="calendar-sede-filter" class="input-modern small">
                            <option value="all">Todas las Sedes</option>
                            <option value="Todas">Todas (Virtual/General)</option>
                            <option value="AQP">Arequipa (AQP)</option>
                            <option value="PRC">Surco (PRC)</option>
                            <option value="NOR">Lima Norte (NOR)</option>
                            <option value="ATE">Ate (ATE)</option>
                            <option value="SJL">San Juan de Lurigancho (SJL)</option>
                            <option value="VES">Villa el Salvador (VES)</option>
                        </select>
                    </div>
                </div>

                <div class="calendar-wrapper card"
                    style="max-width: 1400px; margin: 0 auto; border-radius: 12px; border: 1px solid var(--border-color); padding: 0;">
                    <div id="calendar-controls"
                        style="display: flex; justify-content: space-between; padding: 1rem; background: var(--card-bg); border-bottom: 1px solid var(--border-color);">
                        <button id="btn-prev-month" class="btn-icon small"><i class="ph ph-caret-left"></i></button>
                        <h3 id="current-month-label" style="margin: 0; font-size: 1.1rem; color: var(--text-color);">Mes
                            Actual</h3>
                        <button id="btn-next-month" class="btn-icon small"><i class="ph ph-caret-right"></i></button>
                    </div>

                    <div id="monthly-calendar-grid"
                        style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border-color); border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; overflow: hidden;">
                        <!-- JS generará aquí los días de la semana y las celdas de números de día -->
                    </div>
                </div>
            </section>

            <!-- Sección: Eventos -->
            <section id="eventos" class="content-section">
                <div class="section-header">
                    <h2>Gestión de Eventos</h2>
                    <p>Administra y monitorea el estado de tus eventos académicos.</p>
                    <button id="btn-create-event-new" class="btn-primary" style="margin-top: 1rem;"><i
                            class="ph ph-plus-circle"></i> Crear Nuevo Evento</button>
                </div>

                <div class="events-container">
                    <!-- Filtros / Buscador -->
                    <div class="events-filters" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button id="btn-import-excel" class="btn-secondary small" style="margin-right: 0.5rem;"><i
                                class="ph ph-file-xls"></i> Importar desde Excel</button>
                        <input type="text" id="search-filter" placeholder="Buscar evento..." class="input-modern small">

                        <select id="month-filter" class="input-modern small">
                            <option value="all">Todos los meses</option>
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>

                        <select id="visibility-filter" class="input-modern small">
                            <option value="all">Todas las visibilidades</option>
                            <option value="publico">Solo Públicos</option>
                            <option value="privado">Solo Internos/Privados</option>
                        </select>

                        <select id="status-filter" class="input-modern small">
                            <option value="all">Todos los estados</option>
                            <option value="0">0/7 En proyecto</option>
                            <option value="1">1/7 Planificado</option>
                            <option value="2">2/7 Formalizado</option>
                            <option value="3">3/7 Comunicado</option>
                            <option value="4">4/7 Difundido</option>
                            <option value="5">5/7 Preparado</option>
                            <option value="6">6/7 Realizado</option>
                            <option value="7">7/7 Concluido</option>
                            <option value="Cancelado">Cancelado</option>
                            <option value="Postergado">Postergado</option>
                        </select>
                        <button class="btn-secondary small" onclick="loadEvents()" title="Recargar"><i
                                class="ph ph-arrow-clockwise"></i></button>
                    </div>

                    <!-- Lista de Eventos (Grid) -->
                    <div class="events-grid" id="events-grid">
                        <p style="text-align:center; color: var(--text-muted); padding: 2rem;">Cargando eventos...</p>
                    </div>


                </div>

            </section>

            <!-- Sección: Comunicación -->
            <section id="comunicacion" class="content-section">
                <div class="section-header">
                    <h2>Gestión de Comunicación</h2>
                    <p>Configura las plantillas de correo y mensajes.</p>
                </div>

                <!-- Importación de Datos (Movido a Generación) -->

                <div class="grid-layout">
                    <div class="card">
                        <h3><i class="ph ph-envelope-simple"></i> Plantilla de Correo</h3>
                        <form class="template-form">
                            <div class="form-group">
                                <label>Asunto del Correo</label>
                                <input type="text" placeholder="Ej: Su constancia de participación..."
                                    class="input-modern">
                            </div>
                            <div class="form-group">
                                <label>Cuerpo del Mensaje</label>
                                <textarea placeholder="Hola {nombre}, adjunto encontrarás..."
                                    class="input-modern area"></textarea>
                            </div>
                            <div class="form-actions">
                                <button t ype="button" class="btn-secondary">Vista Previa</button>
                                <button type="button" class="btn-primary">Guardar Plantilla</button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <h3><i class="ph ph-list-dashes"></i> Variables Disponibles</h3>
                        <ul class="variables-list">
                            <li><code>{nombre}</code> - Nombre del destinatario</li>
                            <li><code>{curso}</code> - Nombre del curso/evento</li>
                            <li><code>{fecha}</code> - Fecha de emisión</li>
                            <li><code>{codigo}</code> - Código único</li>
                        </ul>
                    </div>
                </div>
                <div class="card"
                    style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;">
                    <h3><i class="ph ph-paper-plane-tilt"></i> Generar Datos para Envío (Manual)</h3>

                    <div class="card"
                        style="margin-bottom: 2rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.2);">
                        <h4 style="color: #f59e0b; margin-bottom: 0.5rem;"><i class="ph ph-warning-circle"></i>
                            Importante</h4>
                        <p style="font-size: 0.9rem; color: var(--text-muted);">
                            Al usar este método (copiar y pegar en CCO/BCC), todos recibirán el <b>mismo mensaje
                                genérico</b>.
                            No es posible personalizar nombres individuales automáticamente en este modo.
                        </p>
                    </div>

                    <div class="form-group">
                        <label>1. Lista de Correos (Para pegar en CCO / BCC)</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <textarea id="manual-emails" class="input-modern area" readonly
                                style="height: 100px; font-family: monospace; font-size: 0.85rem;"
                                placeholder="Aquí aparecerán los correos de la lista importada..."></textarea>
                            <button class="btn-secondary" onclick="copyToClipboard('manual-emails')" title="Copiar"><i
                                    class="ph ph-copy"></i></button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>2. Asunto Final</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="manual-subject" class="input-modern" readonly
                                placeholder="Se copiará del formulario de arriba...">
                            <button class="btn-secondary" onclick="copyToClipboard('manual-subject')" title="Copiar"><i
                                    class="ph ph-copy"></i></button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>3. Cuerpo del Mensaje Final (Genérico)</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <textarea id="manual-body" class="input-modern area" readonly style="height: 200px;"
                                placeholder="Se generará una versión limpia del mensaje..."></textarea>
                            <button class="btn-secondary" onclick="copyToClipboard('manual-body')" title="Copiar"><i
                                    class="ph ph-copy"></i></button>
                        </div>
                    </div>

                    <div class="action-bar" style="margin-top: 1rem;">
                        <button id="btn-generate-manual" class="btn-primary large"><i
                                class="ph ph-arrows-clockwise"></i> Generar Datos Ahora</button>
                        <a id="mailto-link" href="#" class="btn-secondary large hidden" target="_blank"><i
                                class="ph ph-envelope-open"></i> Abrir Correo</a>
                    </div>
                </div>
            </section>

            <!-- Sección: Generación -->
            <section id="generacion" class="content-section">
                <div class="section-header">
                    <h2>Generación de Constancias</h2>
                    <p>Sube tu base de datos y genera los certificados en PDF.</p>
                </div>

                <div class="card" style="margin-bottom: 2rem;">
                    <h3><i class="ph ph-calendar"></i> 1. Seleccione el Evento</h3>
                    <p style="color:var(--text-muted); margin-bottom:1rem; font-size:0.9rem;">
                        Elija a qué evento desea vincular a los estudiantes.
                    </p>
                    <select id="cert-event-selector" class="input-modern" style="max-width: 600px;">
                        <option value="" disabled selected>Cargando eventos...</option>
                    </select>
                </div>

                <!-- Importación de Datos -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3><i class="ph ph-users-three"></i> 2. Subir Lista de Asistencia (Google Forms .csv)</h3>
                    <p style="color:var(--text-muted); margin-bottom:1.5rem; font-size:0.9rem;">
                        Adjunta el archivo CSV de Asistencia descargado de Google Forms. Asegúrese de haber seleccionado
                        un evento arriba.
                    </p>

                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <input type="file" id="csv-file-input" accept=".csv" class="input-modern"
                            style="max-width: 400px;">
                        <button id="btn-process-csv" class="btn-primary"><i class="ph ph-play"></i> Analizar
                            CSV</button>
                    </div>

                    <!-- Tabla de Previsualización -->
                    <div id="preview-container" class="hidden" style="margin-top: 1.5rem; overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th width="100">Estado</th>
                                    <th>DNI</th>
                                    <th>Participante</th>
                                    <th>Correo Electrónico</th>
                                    <th>Teléfono</th>
                                    <th>Turno</th>
                                    <th>Ciclo</th>
                                    <th>Egresado</th>
                                    <th width="100">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="participants-table-body">
                                <!-- JS Fill -->
                            </tbody>
                        </table>

                        <div
                            style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <span id="import-stats" style="color: var(--text-muted); font-size: 0.9rem;"></span>

                            <!-- Grupo Izquierdo (Legacy Contacts) -->
                            <div style="display: flex; gap: 0.5rem; align-items: center; display: none;">
                                <!-- Hidden since its mostly for legacy email workflow -->
                                <input type="text" id="contact-label" placeholder="Etiqueta (Ej: Webinar)"
                                    class="input-modern small" style="width: 150px;">
                                <button id="btn-export-contacts" class="btn-primary" disabled>
                                    <i class="ph ph-export"></i> Exportar Contactos Google
                                </button>
                            </div>
                            <!-- Grupo Derecho (Data Base Sync) -->
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <button id="btn-save-participantsdb" class="btn-primary"
                                    style="background: #10b981; border-color: #059669;">
                                    <i class="ph ph-database"></i> Guardar en Base de Datos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database View (Students saved for the selected event) -->
                <div class="card">
                    <h3><i class="ph ph-users"></i> 3. Estudiantes Guardados en Base de Datos</h3>
                    <p style="color:var(--text-muted); margin-bottom:1.5rem; font-size:0.9rem;">
                        Lista oficial de estudiantes registrados en Supabase para el evento seleccionado.
                    </p>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>DNI</th>
                                <th>Nombres y Apellidos</th>
                                <th>Correo</th>
                                <th>Estado Constancia / Certificado</th>
                            </tr>
                        </thead>
                        <tbody id="db-participants-table-body">
                            <tr>
                                <td colspan="4" style="text-align:center; padding: 2rem; color: var(--text-muted);">
                                    Selecciona un evento arriba para cargar la lista.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para Crear Evento -->
    <div id="event-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="ph ph-calendar-plus"></i> Crear Nuevo Evento</h2>
                <button class="close-modal"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <form id="event-form">
                    <!-- 1. Tipo de Evento -->
                    <div class="form-group">
                        <label for="event-type">Tipo de Evento</label>
                        <select id="event-type" class="input-modern" required>
                            <option value="" disabled selected>Seleccione un tipo...</option>
                            <option value="Taller">Taller</option>
                            <option value="Webinar">Webinar</option>
                            <option value="Curso">Curso</option>
                            <option value="Capacitación">Capacitación</option>
                            <option value="Apertura Académica">Apertura Académica</option>
                            <option value="Kick Off Académico">Kick Off Académico</option>
                            <option value="Consultoría">Consultoría (participación o asistencia técnica)</option>
                            <option value="Reunión Académica">Reunión Académica</option>
                            <option value="Seminario">Seminario</option>
                            <option value="Congreso">Congreso</option>
                            <option value="Simposio">Simposio</option>
                            <option value="Coloquio">Coloquio</option>
                            <option value="Foro Académico">Foro Académico</option>
                            <option value="Jornada Académica">Jornada Académica</option>
                            <option value="Encuentro de Investigación">Encuentro de Investigación</option>
                            <option value="Hackathon Académico">Hackathon Académico</option>
                            <option value="Mesa Redonda">Mesa Redonda</option>
                            <option value="Presentación de Libro">Presentación de Libro o Investigación</option>
                            <option value="Masterclass">Masterclass</option>
                            <option value="Bootcamp">Bootcamp</option>
                            <option value="Networking Académico">Networking Académico</option>
                            <option value="Demo Day">Demo Day</option>
                            <option value="Open House Académico">Open House Académico</option>
                            <option value="Feria de Carreras">Feria de Carreras</option>
                            <option value="Semana Académica">Semana Académica</option>
                            <option value="Panel de Expertos">Panel de Expertos</option>
                            <option value="Conversatorio">Conversatorio</option>
                            <option value="Clínica Académica">Clínica Académica</option>
                            <option value="Programa de Especialización">Programa de Especialización</option>
                            <option value="Diplomado">Diplomado</option>
                            <option value="Certificación Internacional">Certificación Internacional</option>
                            <option value="Curso de Actualización">Curso de Actualización Profesional</option>
                            <option value="Taller Práctico">Taller Práctico Especializado</option>
                            <option value="Laboratorio Académico">Laboratorio Académico</option>
                            <option value="Programa Ejecutivo">Programa Ejecutivo</option>
                            <option value="Programa In Company">Programa In Company</option>
                        </select>
                    </div>

                    <!-- 2. Nombre del Evento -->
                    <div class="form-group">
                        <label for="event-name">Nombre del Evento</label>
                        <input type="text" id="event-name" class="input-modern"
                            placeholder="Ej: Taller de Robótica Avanzada" required>
                    </div>

                    <!-- 2.5 Ponente -->
                    <div class="form-group">
                        <label for="event-ponente">Ponente / Expositor</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <select id="event-ponente" class="input-modern" required style="flex: 1;">
                                <option value="Pendiente">Pendiente</option>
                                <!-- Se llenará con JavaScript -->
                                <option value="new_ponente" style="font-weight:bold; color:var(--primary-color);">+
                                    Agregar nuevo ponente...</option>
                            </select>
                            <button type="button" id="btn-delete-ponente" class="btn-icon-remove"
                                title="Eliminar ponente seleccionado"
                                style="padding: 0.6rem; border-radius: 6px; border: 1px solid rgba(248, 113, 113, 0.3); background: rgba(248, 113, 113, 0.1); color: #f87171; display: none;">
                                <i class="ph ph-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 2.6 Responsable -->
                    <div class="form-group">
                        <label>Responsables (Opcional, Selección Múltiple)</label>
                        <div class="checkbox-grid" id="responsables-container">
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="Jorge">
                                Jorge</label>
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="Eduardo">
                                Eduardo</label>
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="José">
                                José</label>
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="Mirko">
                                Mirko</label>
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="Luis">
                                Luis</label>
                            <label class="checkbox-option"><input type="checkbox" name="responsable" value="Carlos">
                                Carlos</label>
                        </div>
                    </div>



                    <!-- 2.8 Visibilidad Pública -->
                    <div class="form-group"
                        style="background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2); padding: 1rem; border-radius: 8px;">
                        <label class="checkbox-option"
                            style="font-weight: 500; font-size: 0.95rem; display: flex; align-items: flex-start; gap: 0.5rem; margin: 0; color: #10b981;">
                            <input type="checkbox" id="event-is-public" name="is_public"
                                style="width: 18px; height: 18px; margin-top: 2px;">
                            <span>
                                <strong>Evento compartido de forma pública</strong><br>
                                <small style="color: var(--text-muted); font-weight: normal;">Aparecerá en el cronograma
                                    general con un color distintivo y suma a la difusión externa.</small>
                            </span>
                        </label>
                    </div>

                    <!-- 3. Modalidad -->
                    <div class="form-group">
                        <label>Modalidad</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="modality" value="Virtual" checked>
                                <span>Virtual</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="modality" value="Presencial">
                                <span>Presencial</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="modality" value="Ambas">
                                <span>Ambas</span>
                            </label>
                        </div>
                    </div>

                    <!-- 4. Sedes (Condicional) -->
                    <div id="sedes-container" class="form-group hidden">
                        <label>Sedes (Selección Múltiple)</label>
                        <div class="checkbox-grid">
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="Todas">
                                Todas</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="AQP"> Arequipa
                                (AQP)</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="PRC"> Surco
                                (PRC)</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="NOR"> Lima Norte
                                (NOR)</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="ATE"> Ate
                                (ATE)</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="SJL"> San Juan de
                                Lurigancho (SJL)</label>
                            <label class="checkbox-option"><input type="checkbox" name="sede" value="VES"> Villa el
                                Salvador (VES)</label>
                        </div>
                    </div>

                    <!-- 5. Fechas y Horas -->
                    <div class="form-group">
                        <label>Horario</label>
                        <div id="schedule-list">
                            <!-- Filas de horario se agregan dinámicamente -->
                        </div>
                        <button type="button" id="add-schedule-btn" class="btn-secondary small"><i
                                class="ph ph-plus"></i> Agregar Fecha</button>
                    </div>

                    <!-- 6. Público Objetivo -->
                    <div class="form-group">
                        <label>Dirigido A</label>
                        <div class="checkbox-grid">
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="1"
                                    class="audience-check"> 1er Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="2"
                                    class="audience-check"> 2do Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="3"
                                    class="audience-check"> 3er Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="4"
                                    class="audience-check"> 4to Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="5"
                                    class="audience-check"> 5to Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="6+"
                                    class="audience-check"> 6to Ciclo</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="Egresados"
                                    class="audience-check"> Egresados</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="Docentes"
                                    class="audience-check"> Docentes</label>
                            <label class="checkbox-option"><input type="checkbox" name="audience" value="Publico"
                                    class="audience-check"> Público en General</label>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button type="button" id="btn-toggle-audience-detail" class="btn-secondary small"
                                style="margin-bottom: 0.5rem; font-size: 0.8rem;"><i class="ph ph-plus"></i> Añadir
                                detalle específico (Opcional)</button>
                            <input type="text" id="audience-detail-input" class="input-modern small"
                                placeholder="Ej: matriculados en 1er ciclo, que dictan Inteligencia Artificial..."
                                style="display: none; width: 100%; margin-bottom: 0.5rem;">
                        </div>
                        <div class="audience-summary-box">
                            <small>Resumen de audiencia final:</small>
                            <p id="audience-summary-text" class="summary-text">-</p>
                        </div>
                    </div>
                    <!-- 7. Descripción Corta (Moved to end) -->
                    <div class="form-group">
                        <label for="event-descripcion"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            Descripción breve (Opcional)
                            <button type="button" id="btn-auto-desc" class="btn-secondary small"
                                style="padding: 4px 8px; font-size: 0.75rem;"><i class="ph ph-magic-wand"></i>
                                Auto-generar</button>
                        </label>
                        <textarea id="event-descripcion" class="input-modern area" style="height: 60px;"
                            placeholder="Ej: Webinar a cargo de Juan Pérez. Modalidad: Virtual. Sede: No establecido."></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn-secondary close-modal">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar Evento</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </div>

    <!-- Modal para Importar Evento -->
    <div id="import-event-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="ph ph-file-xls"></i> Importar Evento (Google Sheets)</h2>
                <button class="close-modal"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">

                <!-- Nueva Sincronización Automática -->
                <div
                    style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h4 style="color: #60a5fa; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 6px;">
                        <i class="ph ph-link"></i> Sincronización Automática
                    </h4>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">
                        Pega el enlace público (URL) de tu archivo Google Sheets. El sistema descargará y procesará la
                        hoja visible automáticamente. <b>Importante:</b> El archivo debe estar compartido como
                        <i>Cualquier persona con el enlace (Lector)</i>.
                    </p>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="url" id="sheet-url-input" class="input-modern"
                            placeholder="https://docs.google.com/spreadsheets/d/1Xy_..."
                            style="margin-top: 0; flex: 1;">
                        <button type="button" id="btn-sync-url" class="btn-primary" style="white-space: nowrap;"><i
                                class="ph ph-cloud-arrow-down"></i> Extraer</button>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <hr style="flex: 1; border-color: rgba(255,255,255,0.1);">
                    <small style="color: var(--text-muted); font-weight: 500;">O importación tradicional</small>
                    <hr style="flex: 1; border-color: rgba(255,255,255,0.1);">
                </div>

                <!-- Método Tradicional Fallback -->
                <h4 style="margin-bottom: 0.5rem; color: var(--text-light);"><i class="ph ph-clipboard-text"></i> Pegado
                    Manual</h4>
                <p style="margin-bottom: 1rem; color: var(--text-muted); font-size: 0.85rem;">Copia una <b>fila
                        completa</b> (desde la columna Mes hasta el final) de tu archivo y pégala aquí
                    abajo con Ctrl+V.</p>
                <textarea id="import-event-data" class="input-modern area"
                    style="height: 100px; font-family: monospace; white-space: pre; overflow-x: auto; background: var(--bg-color);"
                    placeholder="[Mes]	[Inicio]	[Fin]	[Hora]	[Actividad]..."></textarea>

                <div id="import-preview" class="hidden"
                    style="margin-top: 1.5rem; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color);">Previsualización del Evento:</h4>
                    <div id="import-preview-content"
                        style="font-size: 0.85rem; color: #cbd5e1; display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <!-- JS Llenado -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary close-modal">Cancelar</button>
                <button type="button" id="btn-process-import" class="btn-primary" disabled><i class="ph ph-check"></i>
                    Guardar Evento</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Ponente -->
    <div id="new-ponente-modal" class="modal-overlay" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2><i class="ph ph-user-plus"></i> Registrar Nuevo Ponente</h2>
                <button class="close-modal" id="close-new-ponente"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <form id="new-ponente-form">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" id="ponente-nombres" class="input-modern" required placeholder="Nombres">
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" id="ponente-apellidos" class="input-modern" required placeholder="Apellidos">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Docente</label>
                        <select id="ponente-tipo" class="input-modern">
                            <option value="Externo">Externo</option>
                            <option value="Docente CERTUS">Docente CERTUS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Especialidad (Opcional)</label>
                        <input type="text" id="ponente-especialidad" class="input-modern"
                            placeholder="Ej: Contabilidad, Tributación...">
                    </div>
                    <div class="modal-footer" style="margin-top:20px; padding:0; border:none;">
                        <button type="button" class="btn-secondary" id="btn-cancel-ponente">Cancelar</button>
                        <button type="submit" class="btn-primary" id="btn-save-ponente">Guardar Ponente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="status-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="ph ph-arrows-clockwise"></i> Gestionar Estado del Evento</h2>
                <button class="close-modal"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <div id="status-event-info" style="margin-bottom: 1.5rem;">
                    <!-- Llenado por JS -->
                </div>

                <div class="status-transition">
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <span id="current-status-badge" class="event-status"></span>
                        <i class="ph ph-arrow-right" style="margin: 0 1rem; color: var(--text-muted);"></i>
                        <span id="next-status-badge" class="event-status"></span>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <h4 style="margin-bottom: 0.5rem;">Requisitos para avanzar:</h4>
                        <ul id="req-list" style="list-style: none; padding: 0;">
                            <!-- Requisitos generados por JS -->
                        </ul>
                    </div>
                </div>

                <!-- Opciones Especiales -->
                <div style="margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                    <div style="display: flex; gap: 1rem; justify-content: space-between;">
                        <button id="btn-show-postponer" class="btn-secondary small" style="flex: 1;"><i
                                class="ph ph-clock"></i> Postergar Evento</button>
                        <button id="btn-show-cancelar" class="btn-secondary small"
                            style="flex: 1; border-color: rgba(248, 113, 113, 0.5); color: #f87171;"><i
                                class="ph ph-warning-circle"></i> Cancelar Evento</button>
                    </div>

                    <!-- Contenedor dinámico de sustento -->
                    <div id="sustento-container" class="hidden"
                        style="margin-top: 1rem; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                        <h4 id="sustento-title" style="margin-bottom: 0.5rem;">Sustento</h4>
                        <p id="sustento-desc"
                            style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;"></p>
                        <textarea id="sustento-text" class="input-modern area"
                            placeholder="Escribe el motivo detallado de esta acción..."></textarea>

                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; justify-content: flex-end;">
                            <button id="btn-cancel-special" class="btn-secondary small">Atrás</button>
                            <button id="btn-confirm-special" class="btn-primary small">Confirmar Acción</button>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; width: 100%;">
                <button type="button" class="btn-secondary close-modal">Cerrar</button>
                <div style="display: flex; gap: 0.5rem;">
                    <button type="button" id="btn-retroceder-status" class="btn-secondary"
                        style="border-color: #f59e0b; color: #f59e0b; display: none;"><i class="ph ph-arrow-left"></i>
                        Retroceder</button>
                    <button type="button" id="btn-advance-status" class="btn-primary">Avanzar Estado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Revisión de Participantes -->
    <div id="participant-review-modal" class="modal-overlay" style="z-index: 2001;" aria-hidden="false">
        <div class="modal-content participant-review-modal">
            <div class="modal-header">
                <h2><i class="ph ph-users"></i> Revisión de Inscritos</h2>
                <button class="close-modal" onclick="closeParticipantReviewModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <div id="sync-stats"
                    style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; text-align: right;">
                    Total: <span id="total-participants">0</span> | <span style="color: #4ade80;">OK: <span
                            id="ok-participants">0</span></span> | <span style="color: #f87171;">Obs: <span
                            id="obs-participants">0</span></span>
                </div>

                <div class="table-responsive">
                    <table class="review-table">
                        <thead>
                            <tr>
                                <th width="40"><input type="checkbox" id="select-all-participants"
                                        onclick="toggleSelectAllParticipants(this.checked)"></th>
                                <th>DNI</th>
                                <th>Nombres</th>
                                <th>Apellidos</th>
                                <th>Correo</th>
                                <th>Celular</th>
                                <th>Categoría</th>
                                <th>Asistió</th>
                                <th>Estado</th>
                                <th width="40"></th>
                            </tr>
                        </thead>
                        <tbody id="modal-participants-table-body">
                            <!-- Llenado dinámico -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer"
                style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div>
                    <button type="button" id="btn-delete-selected" class="btn-secondary"
                        style="color: #f87171; border-color: rgba(248, 113, 113, 0.3); display: none;"
                        onclick="deleteSelectedParticipants()">
                        <i class="ph ph-trash"></i> Eliminar Seleccionados
                    </button>
                    <button type="button" id="btn-add-recipients" class="btn-secondary"
                        style="color: #60a5fa; border-color: rgba(99, 102, 241, 0.3);"
                        onclick="addParticipantsToDraft()">
                        <i class="ph ph-user-plus"></i> Agregar Destinatarios
                    </button>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button type="button" class="btn-secondary" onclick="closeParticipantReviewModal()">Cerrar</button>
                    <button type="button" id="btn-save-participants" class="btn-primary">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Borrador de Recordatorio -->
    <div id="reminder-draft-modal" class="modal-overlay" style="z-index: 2005;" aria-hidden="true">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="ph ph-envelope-simple"></i> Borrador de Recordatorio</h2>
                <button class="close-modal" onclick="closeReminderDraftModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div
                    style="text-align: left; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);">
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">Para:</label>
                        <input type="text" id="rem-draft-to"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">CC:</label>
                        <input type="text" id="rem-draft-cc"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">CCO
                            (Destinatarios):</label>
                        <textarea id="rem-draft-cco"
                            placeholder="Haz clic en 'Revisar Inscritos' y luego en 'Agregar Destinatarios'"
                            style="width: 100%; height: 80px; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px; font-size: 0.85rem; resize: none;"></textarea>
                    </div>
                    <div style="margin-bottom: 0;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">Asunto:</label>
                        <input type="text" id="rem-draft-subject"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                </div>
                <div style="text-align: left;">
                    <label
                        style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; display: block;">Cuerpo
                        del mensaje:</label>
                    <textarea id="rem-draft-text"
                        style="width: 100%; height: 200px; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; background: #f8fafc; color: #1e293b; font-size: 0.95rem; resize: none; outline: none;"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="padding-top: 1rem;">
                <button onclick="copyReminderDraft()" class="btn-primary">
                    <i class="ph ph-copy"></i> Copiar Todo
                </button>
                <button id="btn-open-review-from-draft" class="btn-secondary"
                    style="color: white; background: #10b981; border: none;">
                    <i class="ph ph-users"></i> Revisar Inscritos (Sync)
                </button>
                <button onclick="closeReminderDraftModal()" class="btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Borrador de Constancias -->
    <div id="certificate-draft-modal" class="modal-overlay" style="z-index: 2005;" aria-hidden="true">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">
                <h2><i class="ph ph-certificate"></i> Envío de Constancias de Participación</h2>
                <button class="close-modal" onclick="closeCertificatesDraftModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div
                    style="text-align: left; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);">
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">Para:</label>
                        <input type="text" id="cert-draft-to"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">CC:</label>
                        <input type="text" id="cert-draft-cc"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">CCO
                            (Destinatarios de Constancias):</label>
                        <textarea id="cert-draft-cco"
                            placeholder="Haz clic en 'Revisar Inscritos' y luego en 'Agregar Destinatarios'"
                            style="width: 100%; height: 80px; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px; font-size: 0.85rem; resize: none;"></textarea>
                    </div>
                    <div style="margin-bottom: 0;">
                        <label
                            style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">Asunto:</label>
                        <input type="text" id="cert-draft-subject"
                            style="width: 100%; padding: 8px 10px; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: white; display: block; margin-top: 4px;">
                    </div>
                </div>
                <div style="text-align: left;">
                    <label
                        style="color: #94a3b8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; display: block;">Cuerpo
                        del mensaje:</label>
                    <textarea id="cert-draft-text"
                        style="width: 100%; height: 200px; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; background: #f8fafc; color: #1e293b; font-size: 0.95rem; resize: none; outline: none;"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="padding-top: 1rem;">
                <button onclick="copyCertificatesDraft()" class="btn-primary" style="background: #8b5cf6;">
                    <i class="ph ph-copy"></i> Copiar Todo
                </button>
                <button id="btn-open-review-from-cert" class="btn-secondary"
                    style="color: white; background: #10b981; border: none;">
                    <i class="ph ph-users"></i> Revisar Inscritos (Sync)
                </button>
                <button onclick="closeCertificatesDraftModal()" class="btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="script.js?v=2026-v7-retroceder"></script>
</body>

</html>